# WEB_STREAM_ERROR (web-005)

## Error Description

This error occurs when Cursor Utils encounters a problem with the streaming response from the Perplexity API during a web command. The connection was established successfully, and the API began streaming a response, but the stream was interrupted or contained errors.

## Example Error

```
Ã— ERROR: Error while streaming response from Perplexity API
  Code: web-005
  
  Causes:
  - Network connection was interrupted during streaming
  - Perplexity API returned a malformed response
  - Streaming session timed out
  - Server-side error occurred during response generation
  
  Suggestion: Check your network stability and try again
  
  For more information: https://github.com/gweidart/cursor-utils/errors/web-005.md
```

## Common Causes

1. **Network Interruption**: Your network connection was interrupted during the streaming response.
2. **Malformed Response**: The API returned a response that couldn't be properly parsed or processed.
3. **Streaming Timeout**: The streaming session exceeded the maximum allowed time.
4. **Server-Side Error**: An error occurred on the server while generating the response.
5. **Client-Side Processing**: Issues with processing or displaying the streaming response.
6. **Connection Throttling**: Your network provider or a middlebox is throttling the connection.

## Solutions

### Check network stability

Ensure your network connection is stable:

```bash
# Test continuous connectivity (Ctrl+C to stop)
ping -c 100 api.perplexity.ai

# Check for packet loss
ping -c 100 api.perplexity.ai | grep "packet loss"
```

### Try non-streaming mode

If streaming is causing issues, try using non-streaming mode:

```bash
cursor-utils web "your query" --no-stream
```

### Reduce response size

Limit the size of the response to reduce streaming issues:

```bash
cursor-utils web "your query" --max-tokens 1000
```

### Save response to file

Save the response to a file instead of displaying it in the terminal:

```bash
cursor-utils web "your query" --save-to response.md
```

### Check for rate limiting

If you're making many requests, you might be rate-limited:

```bash
# Space out your requests
sleep 30 && cursor-utils web "your query"
```

### Update Cursor Utils

Make sure you're using the latest version:

```bash
cursor-utils update
```

## Related Commands

- `cursor-utils web --help` - Show help for the web command
- `cursor-utils config show` - Display current configuration
- `cursor-utils update` - Update to the latest version

## Related Error Codes

- [WEB_API_ERROR (web-001)](web-001.md) - Error with Perplexity API
- [WEB_CONNECTION_ERROR (web-003)](web-003.md) - Connection error during web command
- [WEB_TIMEOUT_ERROR (web-004)](web-004.md) - Timeout during web command
- [WEB_MODEL_ERROR (web-006)](web-006.md) - Error with model selection

## Advanced Troubleshooting

### Debug streaming issues

Run with debug mode to get more information about the streaming process:

```bash
cursor-utils web "your query" --debug
```

### Check terminal capabilities

Some terminal emulators might have issues with streaming displays:

```bash
# Try with a simpler terminal
export TERM=xterm-basic
cursor-utils web "your query"
```

### Monitor network during streaming

Monitor your network activity during the streaming process:

```bash
# In another terminal window (Linux/macOS)
watch -n 1 netstat -an | grep perplexity
```

### Check for proxy interference

Proxies or firewalls might interfere with streaming connections:

```bash
# Temporarily disable proxy settings
unset HTTP_PROXY HTTPS_PROXY http_proxy https_proxy
cursor-utils web "your query"
```

## Understanding Streaming Responses

Streaming responses work differently from regular API responses:

1. The API sends partial responses as they're generated
2. Cursor Utils processes and displays these chunks in real-time
3. The connection must remain open until the complete response is received

This approach has benefits (faster initial response, real-time updates) but is more sensitive to network issues.

## Common Streaming Issues

| Issue | Symptoms | Solution |
|-------|----------|----------|
| Partial response | Response cuts off unexpectedly | Use `--save-to` to save partial responses |
| Corrupted output | Garbled text or control characters | Use `--no-stream` option |
| Rate limiting | Frequent disconnects when making multiple requests | Add delays between requests |
| Network jitter | Stuttering display or periodic pauses | Use a more stable network connection |
| Terminal rendering | Display issues in specific terminals | Try a different terminal or use `--save-to` |

## Platform-Specific Considerations

### Linux/macOS

1. Terminal capabilities can affect streaming display:
   ```bash
   # Try different TERM settings
   export TERM=xterm-256color  # or xterm or vt100
   ```

2. Network manager might interfere with long-lived connections:
   ```bash
   # Check NetworkManager settings
   nmcli connection show
   ```

### Windows

1. Windows Firewall might inspect and interfere with streaming:
   - Check Windows Defender Firewall settings
   - Consider temporarily disabling for testing

2. Some Windows terminals handle streaming better than others:
   - Try Windows Terminal instead of cmd.exe
   - Try PowerShell instead of Command Prompt

## Still Having Issues?

If you've tried the solutions above and still encounter the error, please:

1. Collect debugging information:
   ```bash
   cursor-utils web "test query" --debug --save-to debug-output.txt
   ```

2. Check the logs:
   ```bash
   cat ~/.cursor-utils/logs/cursor-utils.log
   ```

3. Try with a minimal query and non-streaming mode:
   ```bash
   cursor-utils web "Hello world" --no-stream
   ```

4. If the issue persists, please [submit a bug report](https://github.com/gweidart/cursor-utils/issues) with:
   - The complete error message
   - Your query
   - Debug logs
   - When during the response the error occurred (beginning, middle, end)
   - Network environment details (ISP, connection type, etc.) 