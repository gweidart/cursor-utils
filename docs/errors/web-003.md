# WEB_CONNECTION_ERROR (web-003)

## Error Description

This error occurs when Cursor Utils encounters a connection issue while trying to communicate with the Perplexity API during a web command. This could be due to network problems, DNS issues, firewall restrictions, or unavailability of the Perplexity API service.

## Example Error

```
Ã— ERROR: Failed to connect to the Perplexity API
  Code: web-003
  
  Causes:
  - Network connectivity issues
  - DNS resolution problems
  - Firewall or proxy restrictions
  - Perplexity API service outage
  
  Suggestion: Check your internet connection and try again later
  
  For more information: https://gweidart.github.io/cursor-utils/errors/web-003.md
```

## Common Causes

1. **Network Issues**: Your internet connection is down or unstable.
2. **DNS Problems**: Cannot resolve the Perplexity API domain.
3. **Firewall Restrictions**: Your firewall is blocking connections to the Perplexity API.
4. **Proxy Issues**: Proxy server configuration is preventing the connection.
5. **Service Outage**: The Perplexity API service is experiencing downtime.
6. **TLS/SSL Issues**: Problems with TLS/SSL certificate validation.

## Solutions

### Check internet connection

Verify that you have a working internet connection:

```bash
# Test general connectivity
ping google.com

# Test connectivity to Perplexity
ping api.perplexity.ai
```

### Check DNS resolution

Ensure that the Perplexity API domain resolves correctly:

```bash
# Linux/macOS
dig api.perplexity.ai

# Windows
nslookup api.perplexity.ai
```

### Check for firewall restrictions

Make sure your firewall allows connections to the Perplexity API:

```bash
# Linux (check if outbound connections are allowed)
sudo iptables -L OUTPUT

# Windows (check Windows Firewall settings)
# Start > Windows Defender Firewall > Advanced Settings > Outbound Rules
```

### Test API endpoint directly

Try to connect to the API endpoint directly:

```bash
# Using curl (if available)
curl -v https://api.perplexity.ai/health

# Using PowerShell (Windows)
Invoke-WebRequest -Uri https://api.perplexity.ai/health
```

### Check proxy settings

If you're using a proxy, ensure it's correctly configured:

```bash
# Check proxy environment variables
echo $HTTP_PROXY
echo $HTTPS_PROXY

# Set proxy if needed
export HTTP_PROXY=http://proxy:port
export HTTPS_PROXY=http://proxy:port
```

### Try with retry and increased timeout

Use retry and increased timeout options:

```bash
cursor-utils web "your query" --retries 3 --timeout 30
```

## Related Commands

- `cursor-utils web --help` - Show help for the web command
- `cursor-utils config show` - Display current configuration
- `cursor-utils test connection` - Test API connectivity

## Related Error Codes

- [WEB_API_ERROR (web-001)](web-001.md) - Error with Perplexity API
- [WEB_TIMEOUT_ERROR (web-004)](web-004.md) - Timeout during web command
- [WEB_STREAM_ERROR (web-005)](web-005.md) - Error with streaming response

## Advanced Troubleshooting

### Check TLS/SSL configuration

TLS/SSL issues can cause connection problems:

```bash
# Test TLS connection
openssl s_client -connect api.perplexity.ai:443

# Windows (PowerShell)
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
```

### Check network latency

High latency can cause connection issues:

```bash
# Linux/macOS
traceroute api.perplexity.ai

# Windows
tracert api.perplexity.ai
```

### Check for IP blocking

Your IP might be blocked by the API service:

```bash
# Try from a different network
# Or use a VPN service temporarily
```

### Use a network traffic analyzer

Tools like Wireshark can help diagnose connection issues:

```bash
# Install and run Wireshark
# Filter for traffic to/from api.perplexity.ai
```

## Common Network Issues and Solutions

| Issue | Symptoms | Solution |
|-------|----------|----------|
| DNS failure | Cannot resolve hostname | Try using a different DNS server (e.g., 8.8.8.8) |
| Firewall blocking | Connection refused | Configure firewall to allow outbound HTTPS connections |
| Proxy issues | Slow or failed connections | Configure proxy settings or bypass proxy |
| TLS/SSL errors | Handshake failures | Update your system's CA certificates |
| IP blocking | Consistent connection failures | Try from a different network or use a VPN |
| Bandwidth issues | Slow, timed out connections | Try during off-peak hours or from a different network |

## Platform-Specific Troubleshooting

### Linux/macOS

1. Check system certificate store:
   ```bash
   ls -la /etc/ssl/certs
   ```

2. Test with cURL with verbose output:
   ```bash
   curl -v https://api.perplexity.ai/health
   ```

3. Check system hosts file:
   ```bash
   cat /etc/hosts | grep perplexity
   ```

### Windows

1. Check Windows certificate store:
   - Start > Run > certmgr.msc

2. Reset network stack:
   ```powershell
   netsh winsock reset
   netsh int ip reset
   ipconfig /flushdns
   ```

3. Check network adapter settings:
   - Control Panel > Network and Internet > Network Connections

## Still Having Issues?

If you've tried the solutions above and still encounter the error, please:

1. Check if the Perplexity API service is experiencing issues:
   - [Perplexity Status Page](https://status.perplexity.ai)

2. Run with debug logging:
   ```bash
   cursor-utils web "test query" --debug
   ```

3. Check the logs:
   ```bash
   cat ~/.cursor-utils/logs/cursor-utils.log
   ```

4. Try a different network (e.g., mobile hotspot, different Wi-Fi network).

5. If the issue persists, please [submit a bug report](https://github.com/gweidart/cursor-utils/issues) with:
   - The complete error message
   - Network diagnostics (ping, traceroute, etc.)
   - Your operating system and version
   - ISP and network configuration details (if relevant) 